{% extends "base.html" %}

{% block title %}Чат - {{ department.name }}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h3>{{ department.name }}</h3>
    </div>
    <div class="card-body">
        <div class="chat-container" id="chat-container">
            {% for message in messages %}
                <div class="message {% if message.user_id == current_user.id %}message-own{% else %}message-other{% endif %}">
                    <strong>{{ message.user.username }}</strong>
                    <div class="message-content">{{ message.content }}</div>
                    <small>{{ message.timestamp.strftime('%d.%m.%Y %H:%M') }}</small>
                    {% if current_user.is_admin %}
                        <button class="btn btn-sm btn-danger float-end delete-message" data-message-id="{{ message.id }}">
                            Удалить
                        </button>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        
        <form id="message-form">
            <input type="hidden" id="department_id" value="{{ department.id }}">
            <div class="input-group">
                <input type="text" class="form-control" id="message" placeholder="Введите сообщение...">
                <button class="btn btn-primary" type="submit">Отправить</button>
            </div>
        </form>
    </div>
</div>

<script>
    const currentUserId = {{ current_user.id }};
</script>
{% endblock %} 